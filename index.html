<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Labor Suppliers Attendance System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #1abc9c;
            --light: #ecf0f1;
            --dark: #34495e;
            --bg-color: #f8f9fa;
            --sidebar-width: 250px;
            --header-height: 70px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: #333;
            overflow-x: hidden;
        }

        /* تصميم صفحة تسجيل الدخول */
        .login-container {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: "";
            position: absolute;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: cover;
            animation: float 15s infinite linear;
        }

        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-50px, -50px) rotate(360deg); }
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            width: 400px;
            max-width: 90%;
            z-index: 1;
            position: relative;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary);
            font-size: 28px;
            font-weight: 700;
        }

        .login-subtitle {
            text-align: center;
            margin-top: 20px;
            color: var(--dark);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }

        .btn {
            display: inline-block;
            padding: 12px 25px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-block {
            width: 100%;
        }

        /* تصميم الهيكل الرئيسي */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* الشريط الجانبي */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary) 0%, var(--dark) 100%);
            color: white;
            height: 100vh;
            position: fixed;
            overflow-y: auto;
            transition: all 0.3s;
            z-index: 1000;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h3 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-left-color: var(--secondary);
        }

        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.15);
            border-left-color: var(--info);
        }

        .menu-item i {
            margin-left: 10px;
            font-size: 18px;
        }

        /* المحتوى الرئيسي */
        .main-content {
            flex: 1;
            margin-right: var(--sidebar-width);
            transition: all 0.3s;
        }

        .header {
            height: var(--header-height);
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-left: 15px;
        }

        .content {
            padding: 30px;
        }

        .page-title {
            font-size: 28px;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
        }

        .page-title i {
            margin-left: 15px;
            color: var(--secondary);
        }

        /* الكروت */
        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 25px;
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .card-title {
            font-size: 20px;
            color: var(--primary);
            font-weight: 600;
        }

        /* الجداول */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        /* الأزرار */
        .btn-sm {
            padding: 8px 15px;
            font-size: 14px;
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-warning {
            background-color: var(--warning);
        }

        .btn-info {
            background-color: var(--info);
        }

        .btn-light {
            background-color: var(--light);
            color: var(--dark);
        }

        /* النماذج */
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }

        .form-col {
            flex: 1;
            padding: 0 10px;
            min-width: 200px;
        }

        /* الإشعارات */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .alert-success {
            background-color: rgba(46, 204, 113, 0.2);
            color: #27ae60;
            border: 1px solid #2ecc71;
        }

        .alert-danger {
            background-color: rgba(231, 76, 60, 0.2);
            color: #c0392b;
            border: 1px solid #e74c3c;
        }

        .alert-warning {
            background-color: rgba(243, 156, 18, 0.2);
            color: #d35400;
            border: 1px solid #f39c12;
        }

        /* الفلاتر */
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 180px;
        }

        /* الإحصائيات */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 15px;
            font-size: 24px;
        }

        .stat-info h3 {
            font-size: 28px;
            margin-bottom: 5px;
            color: var(--primary);
        }

        .stat-info p {
            color: #777;
            font-size: 14px;
        }

        /* الرسوم المتحركة */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* الوسائط المتجاوبة */
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }
            .sidebar-header h3, .menu-item span {
                display: none;
            }
            .main-content {
                margin-right: 70px;
            }
            .menu-item {
                justify-content: center;
                padding: 15px;
            }
            .menu-item i {
                margin-left: 0;
            }
        }

        @media (max-width: 768px) {
            .form-col {
                flex: 100%;
            }
            .stats-container {
                grid-template-columns: 1fr;
            }
            .header {
                padding: 0 15px;
            }
            .content {
                padding: 15px;
            }
        }

        /* تحسينات للأداء */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--secondary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* نماذج */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 22px;
            color: var(--primary);
        }

        .close {
            font-size: 24px;
            cursor: pointer;
            color: #777;
        }

        .close:hover {
            color: var(--danger);
        }
    </style>
</head>
<body>
    <!-- صفحة تسجيل الدخول -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <h1 class="login-title">Labor Suppliers Attendance System</h1>
            <div class="form-group">
                <label for="username">اسم المستخدم</label>
                <input type="text" id="username" class="form-control" placeholder="أدخل اسم المستخدم" value="walid.tarek">
            </div>
            <div class="form-group">
                <label for="password">كلمة المرور</label>
                <input type="password" id="password" class="form-control" placeholder="أدخل كلمة المرور" value="walid104">
            </div>
            <button class="btn btn-block" onclick="login()">تسجيل الدخول</button>
            <div class="login-subtitle">
                Created @Walid Tarek
            </div>
        </div>
    </div>

    <!-- التطبيق الرئيسي -->
    <div id="app" class="app-container" style="display: none;">
        <!-- الشريط الجانبي -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>نظام الحضور</h3>
                <p>موردين العمالة</p>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" onclick="showPage('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>لوحة التحكم</span>
                </div>
                <div class="menu-item" onclick="showPage('employees')">
                    <i class="fas fa-users"></i>
                    <span>الموظفين</span>
                </div>
                <div class="menu-item" onclick="showPage('attendance')">
                    <i class="fas fa-clipboard-check"></i>
                    <span>تسجيل الحضور</span>
                </div>
                <div class="menu-item" onclick="showPage('attendanceReport')">
                    <i class="fas fa-chart-bar"></i>
                    <span>إجمالي الحضور</span>
                </div>
                <div class="menu-item" onclick="showPage('reports')">
                    <i class="fas fa-file-alt"></i>
                    <span>التقارير</span>
                </div>
                <div class="menu-item" id="usersMenuItem" onclick="showPage('users')">
                    <i class="fas fa-user-cog"></i>
                    <span>المستخدمين</span>
                </div>
                <div class="menu-item" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>تسجيل الخروج</span>
                </div>
            </div>
        </div>

        <!-- المحتوى الرئيسي -->
        <div class="main-content">
            <div class="header">
                <div class="page-title">
                    <i class="fas fa-tachometer-alt"></i>
                    <span id="pageTitle">لوحة التحكم</span>
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">و</div>
                    <div>
                        <div id="userGreeting">مرحباً، وليد</div>
                        <div id="userRole" style="font-size: 12px; color: #777;">مسئول</div>
                    </div>
                </div>
            </div>

            <div class="content">
                <!-- صفحة لوحة التحكم -->
                <div id="dashboard" class="page active">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">نظرة عامة على النظام</h2>
                        </div>
                        <p>يهدف نظام حضور موردين العمالة إلى تسهيل متابعة حضور العمال والموظفين التابعين للموردين، وضمان تسجيل البيانات بدقة وسهولة. يتيح النظام إدارة الحضور والانصراف، إنتاج تقارير دقيقة، ومتابعة الالتزام بالمواعيد بطريقة سلسة وموثوقة، مما يدعم تحسين كفاءة العمل وتقليل الأخطاء البشرية.</p>
                        <div class="login-subtitle" style="margin-top: 20px;">
                            تم تطوير هذا النظام بواسطة فريق الـ HR بالبنوك في العاصمة الإدارية
                        </div>
                    </div>

                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-icon" style="background-color: rgba(52, 152, 219, 0.2); color: var(--secondary);">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalEmployees">0</h3>
                                <p>إجمالي الموظفين</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background-color: rgba(46, 204, 113, 0.2); color: var(--success);">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="presentToday">0</h3>
                                <p>موظفين حاضروا اليوم</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background-color: rgba(231, 76, 60, 0.2); color: var(--danger);">
                                <i class="fas fa-user-times"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="absentToday">0</h3>
                                <p>موظفين غائبين اليوم</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background-color: rgba(243, 156, 18, 0.2); color: var(--warning);">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="activeLocations">0</h3>
                                <p>المواقع النشطة</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">آخر النشاطات</h2>
                        </div>
                        <div class="table-container">
                            <table id="recentActivities">
                                <thead>
                                    <tr>
                                        <th>الموظف</th>
                                        <th>النشاط</th>
                                        <th>الوقت</th>
                                        <th>الحالة</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- سيتم ملؤها بالبيانات -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- صفحة الموظفين -->
                <div id="employees" class="page">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">إدارة الموظفين</h2>
                            <div>
                                <input type="file" id="excelFile" accept=".xlsx, .xls" style="display: none;">
                                <button class="btn btn-light btn-sm" onclick="document.getElementById('excelFile').click()">
                                    <i class="fas fa-download"></i> استيراد من Excel
                                </button>
                                <button class="btn btn-success btn-sm" style="margin-right: 10px;" onclick="showAddEmployeeModal()">
                                    <i class="fas fa-plus"></i> إضافة موظف
                                </button>
                            </div>
                        </div>

                        <div class="filters">
                            <div class="filter-group">
                                <label>البحث بالاسم</label>
                                <input type="text" class="form-control" id="employeeSearch" placeholder="ابحث بالاسم" onkeyup="filterEmployees()">
                            </div>
                            <div class="filter-group">
                                <label>الشركة</label>
                                <select class="form-control" id="companyFilter" onchange="filterEmployees()">
                                    <option value="">جميع الشركات</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>الموقع</label>
                                <select class="form-control" id="locationFilter" onchange="filterEmployees()">
                                    <option value="">جميع المواقع</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>&nbsp;</label>
                                <button class="btn btn-info btn-sm" onclick="exportEmployeesToExcel()">
                                    <i class="fas fa-download"></i> تصدير Excel
                                </button>
                            </div>
                        </div>

                        <div class="table-container">
                            <table id="employeesTable">
                                <thead>
                                    <tr>
                                        <th>الرقم القومي</th>
                                        <th>الاسم</th>
                                        <th>المهنة</th>
                                        <th>الشفت</th>
                                        <th>الموقع</th>
                                        <th>الشركة</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- سيتم ملؤها بالبيانات -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- صفحات أخرى (مختصرة للاختصار) -->
                <div id="attendance" class="page">
                    <!-- محتوى صفحة الحضور -->
                </div>
                
                <div id="attendanceReport" class="page">
                    <!-- محتوى صفحة تقارير الحضور -->
                </div>
                
                <div id="reports" class="page">
                    <!-- محتوى صفحة التقارير -->
                </div>
                
                <div id="users" class="page">
                    <!-- محتوى صفحة المستخدمين -->
                </div>
            </div>
        </div>
    </div>

    <!-- نماذج -->
    <div id="addEmployeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">إضافة موظف جديد</h3>
                <span class="close" onclick="closeModal('addEmployeeModal')">&times;</span>
            </div>
            <form id="employeeForm" onsubmit="saveEmployee(event)">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="nationalId">الرقم القومي</label>
                            <input type="text" id="nationalId" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="employeeName">الاسم</label>
                            <input type="text" id="employeeName" class="form-control" required>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="employeeJob">المهنة</label>
                            <input type="text" id="employeeJob" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="employeeShift">الشفت</label>
                            <select id="employeeShift" class="form-control" required>
                                <option value="صباحي">صباحي</option>
                                <option value="مسائي">مسائي</option>
                                <option value="ليلي">ليلي</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="employeeLocation">الموقع</label>
                            <input type="text" id="employeeLocation" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="employeeCompany">الشركة</label>
                            <input type="text" id="employeeCompany" class="form-control" required>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-success btn-block">حفظ الموظف</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // بيانات التطبيق
        let appData = {
            currentUser: null,
            employees: [],
            attendance: [],
            users: [
                { username: "walid.tarek", password: "walid104", name: "وليد", role: "مسئول" },
                { username: "samer.ahmed", password: "samer123", name: "سامر", role: "مشرف" },
                { username: "mohamed.ali", password: "mohamed123", name: "محمد", role: "مشرف" }
            ],
            companies: [],
            locations: []
        };

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            // تحميل البيانات من localStorage إذا كانت موجودة
            loadDataFromStorage();
            
            // إعداد معالج استيراد Excel
            document.getElementById('excelFile').addEventListener('change', handleExcelImport);
            
            // تحديث الإحصائيات
            updateDashboardStats();
        });

        // تحميل البيانات من التخزين المحلي
        function loadDataFromStorage() {
            const savedData = localStorage.getItem('attendanceSystemData');
            if (savedData) {
                appData = {...appData, ...JSON.parse(savedData)};
            }
            
            // تحديث القوائم المنسدلة
            updateFilterOptions();
            
            // عرض الموظفين
            renderEmployeesTable();
        }

        // حفظ البيانات في التخزين المحلي
        function saveDataToStorage() {
            localStorage.setItem('attendanceSystemData', JSON.stringify(appData));
        }

        // تحديث خيارات الفلترة
        function updateFilterOptions() {
            const companyFilter = document.getElementById('companyFilter');
            const locationFilter = document.getElementById('locationFilter');
            
            // إزالة الخيارات القديمة (باستثناء الخيار الأول)
            while (companyFilter.children.length > 1) {
                companyFilter.removeChild(companyFilter.lastChild);
            }
            while (locationFilter.children.length > 1) {
                locationFilter.removeChild(locationFilter.lastChild);
            }
            
            // إضافة الشركات الفريدة
            const uniqueCompanies = [...new Set(appData.employees.map(emp => emp.company))];
            uniqueCompanies.forEach(company => {
                if (company) {
                    const option = document.createElement('option');
                    option.value = company;
                    option.textContent = company;
                    companyFilter.appendChild(option);
                }
            });
            
            // إضافة المواقع الفريدة
            const uniqueLocations = [...new Set(appData.employees.map(emp => emp.location))];
            uniqueLocations.forEach(location => {
                if (location) {
                    const option = document.createElement('option');
                    option.value = location;
                    option.textContent = location;
                    locationFilter.appendChild(option);
                }
            });
        }

        // تسجيل الدخول
        function login() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            
            const user = appData.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                appData.currentUser = user;
                document.getElementById("loginPage").style.display = "none";
                document.getElementById("app").style.display = "flex";
                
                // تحديث معلومات المستخدم
                document.getElementById("userGreeting").textContent = `مرحباً، ${user.name}`;
                document.getElementById("userRole").textContent = user.role;
                document.getElementById("userAvatar").textContent = user.name.charAt(0);
                
                // إذا كان المستخدم مشرفاً، إخفاء صفحة المستخدمين
                if (user.role === "مشرف") {
                    document.getElementById("usersMenuItem").style.display = "none";
                } else {
                    document.getElementById("usersMenuItem").style.display = "flex";
                }
                
                // تحديث الإحصائيات
                updateDashboardStats();
            } else {
                alert("اسم المستخدم أو كلمة المرور غير صحيحة");
            }
        }

        // تسجيل الخروج
        function logout() {
            appData.currentUser = null;
            document.getElementById("app").style.display = "none";
            document.getElementById("loginPage").style.display = "flex";
            document.getElementById("username").value = "";
            document.getElementById("password").value = "";
        }

        // عرض الصفحة المحددة
        function showPage(pageId) {
            // إخفاء جميع الصفحات
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.classList.remove('active');
            });
            
            // إزالة النشاط من جميع عناصر القائمة
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // إضافة النشاط للعنصر المحدد
            event.currentTarget.classList.add('active');
            
            // عرض الصفحة المحددة
            document.getElementById(pageId).classList.add('active');
            
            // تحديث عنوان الصفحة
            const pageTitle = document.getElementById('pageTitle');
            const titles = {
                'dashboard': 'لوحة التحكم',
                'employees': 'الموظفين',
                'attendance': 'تسجيل الحضور',
                'attendanceReport': 'إجمالي الحضور',
                'reports': 'التقارير',
                'users': 'المستخدمين'
            };
            pageTitle.textContent = titles[pageId] || 'لوحة التحكم';
            
            // تحديث البيانات إذا لزم الأمر
            if (pageId === 'dashboard') {
                updateDashboardStats();
            } else if (pageId === 'employees') {
                renderEmployeesTable();
            }
        }

        // تحديث إحصائيات لوحة التحكم
        function updateDashboardStats() {
            document.getElementById('totalEmployees').textContent = appData.employees.length;
            
            // حساب الحضور اليوم (محاكاة)
            const today = new Date().toISOString().split('T')[0];
            const presentToday = appData.attendance.filter(a => a.date === today).length;
            document.getElementById('presentToday').textContent = presentToday;
            document.getElementById('absentToday').textContent = appData.employees.length - presentToday;
            
            // حساب المواقع النشطة
            const activeLocations = [...new Set(appData.employees.map(e => e.location))].length;
            document.getElementById('activeLocations').textContent = activeLocations;
            
            // تحديث النشاطات الأخيرة
            updateRecentActivities();
        }

        // تحديث النشاطات الأخيرة
        function updateRecentActivities() {
            const tbody = document.querySelector('#recentActivities tbody');
            tbody.innerHTML = '';
            
            // إنشاء بعض النشاطات المثالبة
            const activities = [
                { employee: 'أحمد محمد', activity: 'تسجيل حضور', time: '08:15 ص', status: 'ناجح' },
                { employee: 'محمود عبدالله', activity: 'تسجيل حضور', time: '08:20 ص', status: 'ناجح' },
                { employee: 'سامح علي', activity: 'تسجيل حضور', time: '08:25 ص', status: 'مكرر' },
                { employee: 'وليد طارق', activity: 'إضافة موظف جديد', time: '08:30 ص', status: 'ناجح' }
            ];
            
            activities.forEach(activity => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${activity.employee}</td>
                    <td>${activity.activity}</td>
                    <td>${activity.time}</td>
                    <td><span style="color: ${activity.status === 'ناجح' ? 'var(--success)' : 'var(--warning)'};">${activity.status}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // عرض نموذج إضافة موظف
        function showAddEmployeeModal() {
            document.getElementById('addEmployeeModal').style.display = 'flex';
            document.getElementById('employeeForm').reset();
        }

        // إغلاق النموذج
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // حفظ الموظف
        function saveEmployee(event) {
            event.preventDefault();
            
            const employee = {
                id: Date.now(), // استخدام الطابع الزمني كمعرف فريد
                nationalId: document.getElementById('nationalId').value,
                name: document.getElementById('employeeName').value,
                job: document.getElementById('employeeJob').value,
                shift: document.getElementById('employeeShift').value,
                location: document.getElementById('employeeLocation').value,
                company: document.getElementById('employeeCompany').value
            };
            
            appData.employees.push(employee);
            saveDataToStorage();
            updateFilterOptions();
            renderEmployeesTable();
            closeModal('addEmployeeModal');
            
            alert('تم إضافة الموظف بنجاح');
        }

        // عرض جدول الموظفين
        function renderEmployeesTable() {
            const tbody = document.querySelector('#employeesTable tbody');
            tbody.innerHTML = '';
            
            appData.employees.forEach(employee => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employee.nationalId}</td>
                    <td>${employee.name}</td>
                    <td>${employee.job}</td>
                    <td>${employee.shift}</td>
                    <td>${employee.location}</td>
                    <td>${employee.company}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteEmployee(${employee.id})"><i class="fas fa-trash"></i></button>
                        <button class="btn btn-warning btn-sm" onclick="transferEmployee(${employee.id})"><i class="fas fa-exchange-alt"></i></button>
                        <button class="btn btn-info btn-sm" onclick="editEmployee(${employee.id})"><i class="fas fa-edit"></i></button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // تصفية الموظفين
        function filterEmployees() {
            const searchText = document.getElementById('employeeSearch').value.toLowerCase();
            const companyFilter = document.getElementById('companyFilter').value;
            const locationFilter = document.getElementById('locationFilter').value;
            
            const filteredEmployees = appData.employees.filter(employee => {
                const matchesSearch = employee.name.toLowerCase().includes(searchText) || 
                                     employee.nationalId.includes(searchText);
                const matchesCompany = !companyFilter || employee.company === companyFilter;
                const matchesLocation = !locationFilter || employee.location === locationFilter;
                
                return matchesSearch && matchesCompany && matchesLocation;
            });
            
            const tbody = document.querySelector('#employeesTable tbody');
            tbody.innerHTML = '';
            
            filteredEmployees.forEach(employee => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employee.nationalId}</td>
                    <td>${employee.name}</td>
                    <td>${employee.job}</td>
                    <td>${employee.shift}</td>
                    <td>${employee.location}</td>
                    <td>${employee.company}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteEmployee(${employee.id})"><i class="fas fa-trash"></i></button>
                        <button class="btn btn-warning btn-sm" onclick="transferEmployee(${employee.id})"><i class="fas fa-exchange-alt"></i></button>
                        <button class="btn btn-info btn-sm" onclick="editEmployee(${employee.id})"><i class="fas fa-edit"></i></button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // حذف موظف
        function deleteEmployee(id) {
            if (confirm("هل تريد حذف الموظف نهائياً؟")) {
                appData.employees = appData.employees.filter(emp => emp.id !== id);
                saveDataToStorage();
                renderEmployeesTable();
                updateDashboardStats();
                alert("تم حذف الموظف بنجاح");
            }
        }

        // نقل موظف
        function transferEmployee(id) {
            const employee = appData.employees.find(emp => emp.id === id);
            if (employee) {
                const newCompany = prompt(`نقل الموظف ${employee.name} إلى شركة:`, employee.company);
                if (newCompany) {
                    employee.company = newCompany;
                    saveDataToStorage();
                    renderEmployeesTable();
                    updateFilterOptions();
                    alert("تم نقل الموظف بنجاح");
                }
            }
        }

        // تعديل موظف
        function editEmployee(id) {
            const employee = appData.employees.find(emp => emp.id === id);
            if (employee) {
                document.getElementById('nationalId').value = employee.nationalId;
                document.getElementById('employeeName').value = employee.name;
                document.getElementById('employeeJob').value = employee.job;
                document.getElementById('employeeShift').value = employee.shift;
                document.getElementById('employeeLocation').value = employee.location;
                document.getElementById('employeeCompany').value = employee.company;
                
                // تغيير نص الزر إلى "تحديث"
                const submitBtn = document.querySelector('#employeeForm button[type="submit"]');
                submitBtn.textContent = 'تحديث الموظف';
                submitBtn.onclick = function(event) {
                    event.preventDefault();
                    updateEmployee(id);
                };
                
                document.getElementById('addEmployeeModal').style.display = 'flex';
            }
        }

        // تحديث بيانات الموظف
        function updateEmployee(id) {
            const employee = appData.employees.find(emp => emp.id === id);
            if (employee) {
                employee.nationalId = document.getElementById('nationalId').value;
                employee.name = document.getElementById('employeeName').value;
                employee.job = document.getElementById('employeeJob').value;
                employee.shift = document.getElementById('employeeShift').value;
                employee.location = document.getElementById('employeeLocation').value;
                employee.company = document.getElementById('employeeCompany').value;
                
                saveDataToStorage();
                renderEmployeesTable();
                updateFilterOptions();
                closeModal('addEmployeeModal');
                
                // إعادة تعيين الزر إلى حالته الأصلية
                const submitBtn = document.querySelector('#employeeForm button[type="submit"]');
                submitBtn.textContent = 'حفظ الموظف';
                submitBtn.onclick = function(event) {
                    event.preventDefault();
                    saveEmployee(event);
                };
                
                alert('تم تحديث بيانات الموظف بنجاح');
            }
        }

        // استيراد بيانات من Excel
        function handleExcelImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                
                // افتراض أن الورقة الأولى تحتوي على البيانات
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                // تحويل البيانات إلى تنسيق التطبيق
                const importedEmployees = jsonData.map(row => ({
                    id: Date.now() + Math.random(), // معرّف فريد
                    nationalId: row['الرقم القومي'] || row['nationalId'] || '',
                    name: row['الاسم'] || row['name'] || '',
                    job: row['المهنة'] || row['job'] || '',
                    shift: row['الشفت'] || row['shift'] || 'صباحي',
                    location: row['الموقع'] || row['location'] || '',
                    company: row['الشركة'] || row['company'] || ''
                }));
                
                // دمج البيانات المستوردة مع البيانات الحالية
                appData.employees = [...appData.employees, ...importedEmployees];
                saveDataToStorage();
                updateFilterOptions();
                renderEmployeesTable();
                updateDashboardStats();
                
                alert(`تم استيراد ${importedEmployees.length} موظف بنجاح`);
                
                // إعادة تعيين حقل الملف
                event.target.value = '';
            };
            reader.readAsArrayBuffer(file);
        }

        // تصدير بيانات الموظفين إلى Excel
        function exportEmployeesToExcel() {
            if (appData.employees.length === 0) {
                alert('لا توجد بيانات للتصدير');
                return;
            }
            
            // تحويل البيانات إلى تنسيق Excel
            const worksheet = XLSX.utils.json_to_sheet(appData.employees.map(emp => ({
                'الرقم القومي': emp.nationalId,
                'الاسم': emp.name,
                'المهنة': emp.job,
                'الشفت': emp.shift,
                'الموقع': emp.location,
                'الشركة': emp.company
            })));
            
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'الموظفين');
            
            // حفظ الملف
            XLSX.writeFile(workbook, 'الموظفين.xlsx');
        }

        // إضافة بعض البيانات المثالبة للاختبار
        function addSampleData() {
            if (appData.employees.length === 0) {
                appData.employees = [
                    {
                        id: 1,
                        nationalId: '29805150101234',
                        name: 'أحمد محمد أحمد',
                        job: 'عامل بناء',
                        shift: 'صباحي',
                        location: 'الموقع أ',
                        company: 'شركة أ'
                    },
                    {
                        id: 2,
                        nationalId: '29907150101235',
                        name: 'محمود عبدالله سعيد',
                        job: 'نجار',
                        shift: 'مسائي',
                        location: 'الموقع ب',
                        company: 'شركة ب'
                    },
                    {
                        id: 3,
                        nationalId: '30008150101236',
                        name: 'سامح علي محمود',
                        job: 'سباك',
                        shift: 'صباحي',
                        location: 'الموقع أ',
                        company: 'شركة أ'
                    }
                ];
                
                saveDataToStorage();
                updateFilterOptions();
                renderEmployeesTable();
                updateDashboardStats();
            }
        }

        // استدعاء هذه الدالة لإضافة بيانات مثالبة إذا لم تكن هناك بيانات
        addSampleData();
    </script>
</body>
</html>